<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>running-ng Documentation</title>
        <meta name="robots" content="noindex" />
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="intro.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="install.html"><strong aria-hidden="true">1.1.</strong> Installation</a></li></ol></li><li class="chapter-item expanded "><a href="quickstart.html"><strong aria-hidden="true">2.</strong> Quickstart</a></li><li class="chapter-item expanded "><a href="basics/index.html"><strong aria-hidden="true">3.</strong> Basics</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="basics/design.html"><strong aria-hidden="true">3.1.</strong> Design Principles</a></li></ol></li><li class="chapter-item expanded "><a href="references/index.html"><strong aria-hidden="true">4.</strong> Core References</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="references/suite.html"><strong aria-hidden="true">4.1.</strong> Benchmark Suite</a></li><li class="chapter-item expanded "><a href="references/runtime.html"><strong aria-hidden="true">4.2.</strong> Runtime</a></li><li class="chapter-item expanded "><a href="references/modifier.html"><strong aria-hidden="true">4.3.</strong> Modifier</a></li></ol></li><li class="chapter-item expanded "><a href="commands/index.html"><strong aria-hidden="true">5.</strong> Command References</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="commands/runbms.html"><strong aria-hidden="true">5.1.</strong> runbms</a></li><li class="chapter-item expanded "><a href="commands/minheap.html"><strong aria-hidden="true">5.2.</strong> minheap</a></li><li class="chapter-item expanded "><a href="commands/fillin.html"><strong aria-hidden="true">5.3.</strong> fillin</a></li></ol></li><li class="chapter-item expanded "><a href="cookbook/index.html"><strong aria-hidden="true">6.</strong> Cookbook</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="cookbook/perf_events.html"><strong aria-hidden="true">6.1.</strong> Performance Event Monitoring</a></li></ol></li><li class="chapter-item expanded "><a href="faq.html"><strong aria-hidden="true">7.</strong> Frequently Asked Questions</a></li><li class="chapter-item expanded "><a href="changelog.html"><strong aria-hidden="true">8.</strong> Changelog</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">running-ng Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p><code>running-ng</code> is a collection of scripts that help people run workloads in a methodologically sound settings.</p>
<h2 id="disclaimer"><a class="header" href="#disclaimer">Disclaimer</a></h2>
<p>At this stage, the focus of this project is driven by the internal use of members from <a href="https://users.cecs.anu.edu.au/%7Esteveb/">Steve Blackburn</a>'s lab.
If you are a member of the lab, you know what to do if you encounter any issue, and you can ignore the below.</p>
<p>If you are a member of the public, please kindly note that the project is open-source and documented on a &quot;good-faith&quot; basis.
We might not have the time to consider your features requests.
Please don't be offended if we ignore these.
Having said that, you are very welcomed to use it, and we will be very pleased if this helps anyone.
In particular, we are grateful if you report bugs you found with steps to reproduce it.</p>
<h2 id="-warning"><a class="header" href="#-warning">⚠️ Warning</a></h2>
<p>The syntax (of configuration files and command line arguments) of <code>running-ng</code> is not stabilized yet.
When you use it, expect breaking changes, although we will try to minimize this where possible.</p>
<p><code>running-ng</code> has been tested by few people, and we think it is stable enough to use for your experiments.
However, there are probably few wrinkles to be ironed out.
Please file any bug or feature request on <a href="https://github.com/caizixian/running-ng/issues">the issue tracker</a>.</p>
<p>You are also welcome to implement new features and/or fix bugs by opening <a href="https://github.com/caizixian/running-ng/pulls">pull requests</a>.
But before you do so, please discuss with <a href="https://github.com/steveblackburn">Steve</a> first for major design changes.
For non-user-facing changes, please discuss with the <a href="intro.html#maintainers">maintainers</a> first.</p>
<h2 id="history"><a class="header" href="#history">History</a></h2>
<p>The predecessor of <code>running-ng</code> is <code>running</code>, a set of scripts written in Perl, dating back to 2005.
However, the type of workloads we are evaluation has changed a bit, and we want a new set of scripts that fit our needs better.</p>
<p>Two major sources of inspiration are <a href="https://gitlab.anu.edu.au/mu/mu-perf-benchmarks"><code>mu-perf-benchmarks</code></a> and <a href="https://github.com/caizixian/menthol"><code>menthol</code></a>.</p>
<p><code>mu-perf-benchmarks</code> is a performance regression framework built for <a href="http://microvm.github.io/">The Mu Micro Virtual Machine</a>.
Zixian coauthored the framework with <a href="https://github.com/john5f35">John Zhang</a> in 2017.
It features <a href="https://gitlab.anu.edu.au/mu/mu-perf-benchmarks/-/tree/master/mubench">a web frontend</a> for displaying results.
You can see the live instance <a href="https://squirrel.anu.edu.au/mubench/">here</a>.</p>
<p><code>menthol</code> is a benchmarking framework built for running benchmarks in high-performance computing (HPC) settings.
Zixian built it for his <a href="https://www.zcai.org/cv#chapel-scnc2101-2018">research project</a> about evaluating Chapel's performance in 2018.
The framework can run benchmarks in different languages on either single node or on a cluster through PBS job scheduler.</p>
<h2 id="maintainers"><a class="header" href="#maintainers">Maintainers</a></h2>
<ul>
<li><a href="https://www.zcai.org">Zixian Cai</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installation"><a class="header" href="#installation">Installation</a></h1>
<p>For now, the best way to install <code>running-ng</code> is via source.</p>
<pre><code class="language-bash">git clone https://github.com/anupli/running-ng
cd running-ng
pip3 install -e . --user
</code></pre>
<p>The <code>-e</code> option is used to allow quick update of <code>running-ng</code> by running <code>git pull</code>.
Once the codebase is more stabilized, other installation options, such as installing from PyPI, could be preferable.</p>
<h2 id="adding-running-to-path"><a class="header" href="#adding-running-to-path">Adding <code>running</code> to <code>PATH</code></a></h2>
<p>You will need to add the folder where <code>running</code> is installed to your <code>PATH</code>.
On a typical Linux installation, <code>running</code> is installed to <code>~/.local/bin</code>.</p>
<p>You will need to refer to the documentation of the shell you are using.</p>
<p>Here is an example for bash.</p>
<pre><code class="language-bash"># Add the following to ~/.bashrc
PATH=$PATH:$HOME/.local/bin
</code></pre>
<p>You don't need to use <code>export</code>.
Generally, <code>$PATH</code> already exists and is exported to child processes.</p>
<p>Please check whether your <code>~/.bash_profile</code> or <code>~/.profile</code> <code>source</code>s <code>~/.bashrc</code>.
If not, when you use a login shell (e.g., in the case of tmux), the content of <code>~/.bashrc</code> might not be applied.</p>
<p>To ensure <code>~/.bashrc</code> is always sourced, you can add the following to <code>~/.bash_profile</code>.</p>
<pre><code class="language-bash">if [ -f ~/.bashrc ]; then
  . ~/.bashrc
fi
</code></pre>
<p>If you are a moma user, please change these dotfiles on <code>squirrel.moma</code>, and then run <code>sudo /moma-admin/config/update_self.fish</code>.
Please check <a href="https://squirrel.anu.edu.au/#customization">here</a> for how to setup a UNIX password for <code>sudo</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="quickstart"><a class="header" href="#quickstart">Quickstart</a></h1>
<p>This guide will show you how to use <code>running-ng</code> to compare two different builds of JVMs.</p>
<h2 id="installation-1"><a class="header" href="#installation-1">Installation</a></h2>
<p>Please follow the <a href="./install.html">installation guide</a> to install <code>running-ng</code>.
You will need Python 3.6+.</p>
<p>Then, create a file <code>two_builds.yml</code> with the following content.</p>
<pre><code class="language-yaml">includes:
  - &quot;/path/to/running-ng/config/base/runbms.yml&quot;
</code></pre>
<p>The <a href="./references/index.html">YAML file</a> represents a dictionary (key-value pairs) that defines the experiments you are running.
The <code>includes</code> directive here will populate the dictionary with some default values shipped with <code>running-ng</code>.</p>
<h2 id="prepare-benchmarks"><a class="header" href="#prepare-benchmarks">Prepare Benchmarks</a></h2>
<p>Add the following to <code>two_builds.yml</code>.</p>
<pre><code class="language-yaml">benchmarks:
  dacapochopin-69a704e:
    - avrora
    - batik
    - biojava
    - cassandra
    - eclipse
    - fop
    - graphchi
    - h2
    - h2o
    - jme
    - jython
    - luindex
    - lusearch
    - pmd
    - sunflow
    - tradebeans 
    - tradesoap
    - tomcat
    - xalan
    - zxing
</code></pre>
<p>This specify a list of benchmarks used in this experiment from the <a href="./references/suite.html">benchmark suite</a> <code>dacapochopin-69a704e</code>.
The benchmark suite is defined in <code>/path/to/running-ng/config/base/dacapo.yml</code>.
The <code>minheap</code> value of <code>dacapochopin-69a704e</code> is measured with AdoptOpenJDK 11 using G1 GC.</p>
<p>Then, add the following to <code>two_builds.yml</code>.</p>
<pre><code class="language-yaml">overrides:
  &quot;suites.dacapochopin-69a704e.timing_iteration&quot;: 5
  &quot;suites.dacapochopin-69a704e.callback&quot;: &quot;probe.DacapoChopinCallback&quot;
</code></pre>
<p>That is, we want to run five iterations for each invocation, and use <code>DacapoChopinCallback</code> because it is the appropriate callback for this release of DaCapo.</p>
<h2 id="prepare-your-builds"><a class="header" href="#prepare-your-builds">Prepare Your Builds</a></h2>
<p>In this guide, we assume you use <a href="https://github.com/mmtk/mmtk-openjdk"><code>mmtk-openjdk</code></a>.
Please follow its build guide.</p>
<p>I assume you produced two different builds you want to compare.
Add the following to <code>two_builds.yml</code>.</p>
<pre><code class="language-yaml">runtimes:
  build1:
    type: OpenJDK
    release: 11
    home: &quot;/path/to/build1/jdk&quot; # make sure /path/to/build1/jdk/bin/java exists
  build2:
    type: OpenJDK
    release: 11
    home: &quot;/path/to/build2/jdk&quot; # make sure /path/to/build2/jdk/bin/java exists
</code></pre>
<p>This defines two builds of <a href="./references/runtime.html">runtimes</a>.</p>
<p>I recommend that you use absolute paths for the builds, although relative paths will work, and will be relative to where you run <code>running</code>.</p>
<p>I strongly recommend you rename the builds (both the name in the configuration file and the folder name) to something more sensible, preferably with the commit hash for easy troubleshooting and performance debugging later.</p>
<h2 id="prepare-probes"><a class="header" href="#prepare-probes">Prepare Probes</a></h2>
<p>Please clone <a href="https://github.com/anupli/probes"><code>probes</code></a>, and run <code>make</code>.</p>
<p>Add the following to <code>two_builds.yml</code>.</p>
<pre><code class="language-yaml">modifiers:
  probes_cp:
    type: JVMClasspath
    val: &quot;/path/to/probes /path/to/probes/probes.jar&quot;
  probes:
    type: JVMArg
    val: &quot;-Djava.library.path=/path/to/probes -Dprobes=RustMMTk&quot;
</code></pre>
<p>This defines two <a href="./references/modifier.html">modifiers</a>, which will be used later to modify the JVM command line arguments.</p>
<p>Please only use absolute paths for all the above.</p>
<h2 id="prepare-configs"><a class="header" href="#prepare-configs">Prepare Configs</a></h2>
<p>Finally, add he following to <code>two_builds.yml</code>.</p>
<pre><code class="language-yaml">configs:
  - &quot;build1|ms|s|c2|mmtk_gc-SemiSpace|tph|probes_cp|probes&quot;
  - &quot;build2|ms|s|c2|mmtk_gc-SemiSpace|tph|probes_cp|probes&quot;
</code></pre>
<p>The syntax is described <a href="./references/index.html#configs">here</a>.</p>
<h2 id="sanity-checks"><a class="header" href="#sanity-checks">Sanity Checks</a></h2>
<p>The basic form of usage looks like this.</p>
<pre><code class="language-console">running runbms /path/to/log two_builds.yml 8
</code></pre>
<p>That is, run the experiments as specified by <code>two_builds.yml</code>, store the results in <code>/path/to/log</code>, and explore eight different heap sizes (with careful arrangement of which size to run first and which to run later).</p>
<p>See <a href="./commands/runbms.html">here</a> for a complete reference of <code>runbms</code>.</p>
<h3 id="dry-run"><a class="header" href="#dry-run">Dry run</a></h3>
<p>A dry run (by supplying <code>-d</code> to <code>running</code> <strong>NOT</strong> <code>runbms</code>) allows you to see the commands to be executed.</p>
<pre><code class="language-console">running -d runbms /path/to/log two_builds.yml 8 -i 1
</code></pre>
<p>Make sure it looks like what you want.</p>
<h3 id="single-invocation"><a class="header" href="#single-invocation">Single Invocation</a></h3>
<p>Now, actually run the experiment, but only for one invocation (by supplying <code>-i 1</code> to <code>runbms</code>).</p>
<pre><code class="language-console">running runbms /path/to/log two_builds.yml 8 -i 1
</code></pre>
<p>This allows you to see any issue before wasting several days only realizing that something didn't work.</p>
<h2 id="run-it"><a class="header" href="#run-it">Run It</a></h2>
<p>Once you are happy with everything, run the experiments.</p>
<pre><code class="language-console">running runbms /path/to/log two_builds.yml 8 -p &quot;two_builds&quot;
</code></pre>
<p>Don't forget to give the results folder a prefix so that you can later tell what the experiment was for.</p>
<h3 id="analysing-results"><a class="header" href="#analysing-results">Analysing Results</a></h3>
<p>This is outside the scope of this quickstart guide.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="basics"><a class="header" href="#basics">Basics</a></h1>
<p><em>Briefly talk about how basic concepts fit together here...</em></p>
<p>Before diving into the details, please read <a href="basics/./design.html">the design principles</a> to help you better understand why things are organized in such way.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="design-principles"><a class="header" href="#design-principles">Design Principles</a></h1>
<h2 id="sound-methodology"><a class="header" href="#sound-methodology">Sound methodology</a></h2>
<p>Sound methodology is crucial for the type of performance analysis work we do.
Please see the documentation for each of the command for details.
We also try to include sensible default values in the base configuration files.</p>
<h2 id="reproducibility"><a class="header" href="#reproducibility">Reproducibility</a></h2>
<p>It should be easy to reproduce a set of experiments.
To this end, various commands will save as much metadata with the results.
For example, <a href="basics/../commands/runbms.html"><code>runbms</code></a> saves the flattened configuration file and command line arguments in the results folder.
For each log, basic information about the execution environment, such as <code>uname</code>, the model name of the CPU, and frequencies of CPU cores, is saved as well.</p>
<h2 id="extensibility"><a class="header" href="#extensibility">Extensibility</a></h2>
<p>Broadly, the project consists of two parts: the core and the commands.
The core provides abstractions for core concepts, such as benchmarks and execution environments, and can be extended through class inheritance.</p>
<p>The commands are the user-facing parts that uses the core to provide concrete functionalities.</p>
<h2 id="reusability"><a class="header" href="#reusability">Reusability</a></h2>
<p>The configuration files can be easily reused through the <code>includes</code> and <code>overrides</code> mechanisms.
For example, people might want to run multiple sets of experiments with minor tweaks, and being able to share a common base configuration file is ergonomic.
This is also crucial to the first point that people can get a set of sensible default values by including base configuration files shipped with the project.</p>
<h2 id="human-readable-syntax"><a class="header" href="#human-readable-syntax">Human-readable syntax</a></h2>
<p>We use YAML as the format for the configuration files.
Please read the <a href="basics/../references/index.html">syntax reference</a> for more details.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="configuration-file-syntax"><a class="header" href="#configuration-file-syntax">Configuration File Syntax</a></h1>
<p>The configuration file is in YAML format.
You can find a good YAML tutorial
<a href="https://docs.ansible.com/ansible/latest/reference_appendices/YAMLSyntax.html">here</a>.
Below is the documentation for all the top-level keys that are common to all
commands.</p>
<h2 id="benchmarks"><a class="header" href="#benchmarks"><code>benchmarks</code></a></h2>
<p>A YAML list of benchmarks to run in each specified <a href="references/index.html#suites">benchmark suite</a>.</p>
<p>For example:</p>
<pre><code class="language-yaml">benchmarks:
  dacapo2006:
    - eclipse
  dacapobach:
    - avrora
    - fop
</code></pre>
<p>specifies <code>running</code> to run the <code>eclipse</code> benchmark from the <code>dacapo2006</code>
benchmark suite; and the <code>avrora</code> and <code>fop</code> benchmarks from the <code>dacapobach</code>
benchmark suite. These benchmark suites have to be defined previously (usually
through an <a href="references/index.html#includes"><code>includes</code> key</a>).</p>
<h2 id="configs"><a class="header" href="#configs"><code>configs</code></a></h2>
<p>A YAML list of configuration strings to be used to run the benchmarks. These are
specified as a <a href="references/index.html#runtimes"><code>runtime</code></a> followed by a <code>'|'</code> separated list of
<a href="references/./modifier.html">modifiers</a>, i.e. <code>&quot;&lt;runtime&gt;|&lt;modifier&gt;|...|&lt;modifier&gt;&quot;</code>.</p>
<p>For example:</p>
<pre><code class="language-yaml">configs:
  - &quot;openjdk11|ms|s|c2&quot;
  - &quot;openjdk15|ms|s&quot;
</code></pre>
<p>specifies <code>running</code> to use the <code>openjdk11</code> <code>runtime</code> with <code>ms</code>, <code>s</code>, and <code>c2</code>
modifiers; and the <code>openjdk15</code> <code>runtime</code> with the <code>ms</code>, and <code>s</code> modifiers. In
the example above, we assume that both the <code>runtimes</code> and modifiers have been
previously defined (in either the current configuration file or in an <a href="references/index.html#includes"><code>includes</code>
file</a>).</p>
<h2 id="includes"><a class="header" href="#includes"><code>includes</code></a></h2>
<p>A YAML list of paths to YAML files that are to be included into the current
configuration file for definitions of some keys.</p>
<p>This is primarily used to provide re-usability and extensibility of
configuration files. A pre-processor step in <code>running</code> takes care of including
all the specified files. A flattened version of the final configuration file is
also generated and placed in the results folder for reproducibility.</p>
<p>For example:</p>
<pre><code class="language-yaml">includes:
 - &quot;./base/suites.yml&quot;
 - &quot;./base/modifiers.yml&quot;
</code></pre>
<p>includes the <code>suites.yml</code> and <code>modifiers.yml</code> files located at <code>./base</code>
respectively.</p>
<h2 id="overrides"><a class="header" href="#overrides"><code>overrides</code></a></h2>
<p>Under construction 🚧.</p>
<h2 id="modifiers"><a class="header" href="#modifiers"><code>modifiers</code></a></h2>
<p>A YAML dictionary of program arguments or environment variables that are to be
used with <a href="references/index.html#configs">config strings</a>. Cannot use <code>-</code> in the key for a modifier.
Each modifier requires a <code>type</code> key with other keys being specific to that
<code>type</code>. For more information regarding the different <code>type</code>s of modifiers,
please refer to <a href="references/./modifier.html">this page</a>.</p>
<p><strong>Warning preview feature ⚠️</strong>. We can exclude certain benchmarks from using a
specific modifier by using an <code>exclude</code> key along with a YAML list of benchmarks
to be excluded from each benchmark suite.</p>
<p>For example:</p>
<pre><code class="language-yaml">modifiers:
  s:
    type: JVMArg
    val: &quot;-server&quot;
  c2:
    type: JVMArg
    val: &quot;-XX:-TieredCompilation -Xcomp&quot;
    excludes:
      dacapo2006:
        - eclipse
</code></pre>
<p>specifies two modifiers, <code>s</code> and <code>c2</code>, both of <code>type</code>
<a href="references/./modifier.html#JVMArg"><code>JVMArg</code></a> with their respective values. Here, the
<code>eclipse</code> benchmark from the <code>dacapo2006</code> benchmark suite has been excluded from
the <code>c2</code> modifier.</p>
<h3 id="value-options"><a class="header" href="#value-options">Value Options</a></h3>
<p>These are special modifiers whose values can be specified through their use in a
<a href="references/index.html#configs">configuration string</a>. Concrete values are specified as <code>-</code> separated
values after the modifier's name in a configuration string. These values will be
indexed by the modifier through syntax similar to Python format strings.</p>
<p>This is best understood via an example:</p>
<pre><code class="language-yaml">modifiers:
  env_var:
    type: EnvVar
    var: &quot;FOO{0}&quot;
    val: &quot;{1}&quot;

[...]

configs:
  - &quot;openjdk11|env_var-42-43&quot;
</code></pre>
<p>specifies to run the <code>openjdk11</code> <a href="references/index.html#runtimes"><code>runtime</code></a> with the environment
variable <code>FOO42</code> set to <code>43</code>. Note that value options are not limited only to
environment variables, and can be used for all modifier <code>type</code>s.</p>
<h2 id="runtimes"><a class="header" href="#runtimes"><code>runtimes</code></a></h2>
<p>A YAML dictionary of runtime definitions that are to be used with <a href="references/index.html#configs">config strings</a>.
Each runtime requires a <code>type</code> key with other keys being specific to that
<code>type</code>. For more information regarding the different <code>type</code>s of runtimes,
please refer to <a href="references/./runtime.html">this page</a>.</p>
<h2 id="suites"><a class="header" href="#suites"><code>suites</code></a></h2>
<p>A YAML dictionary of benchmark suite definitions that are to be used as keys of <code>benchmarks</code>.
Each benchmark suite requires a <code>type</code> key with other keys being specific to that
<code>type</code>. For more information regarding the different <code>type</code>s of benchmark suites,
please refer to <a href="references/./suite.html">this page</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="benchmark-suite"><a class="header" href="#benchmark-suite">Benchmark Suite</a></h1>
<h2 id="binarybenchmarksuite--preview-"><a class="header" href="#binarybenchmarksuite--preview-"><code>BinaryBenchmarkSuite</code>  (preview ⚠️)</a></h2>
<p>A <code>BinaryBenchmarkSuite</code> is a suite of programs which can be used to run binary
benchmarks such as for C/C++ benchmarking.</p>
<h3 id="keys"><a class="header" href="#keys">Keys</a></h3>
<p><code>programs</code>: A yaml list of benchmarks in the format:</p>
<pre><code class="language-yaml">programs:
  &lt;BM_NAME_1&gt;:
    path: /full/path/to/benchmark/binary_1
    args: &quot;Any arguments to binary_1&quot;
  &lt;BM_NAME_2&gt;:
    path: /full/path/to/benchmark/binary_2
    args: &quot;Any arguments to binary_2&quot;
  [...]
</code></pre>
<p>A possible use-case could use wrapper shell scripts around the benchmark to
output timing and other information in a tab-separated table.</p>
<h2 id="dacapo"><a class="header" href="#dacapo"><code>DaCapo</code></a></h2>
<p><a href="http://dacapo-bench.org/">DaCapo benchmark suite</a>.</p>
<h3 id="keys-1"><a class="header" href="#keys-1">Keys</a></h3>
<p><code>release</code>: one of the possible values <code>[&quot;2006&quot;, &quot;9.12&quot;, &quot;evaluation&quot;]</code>.
The value is required.</p>
<p><code>path</code>: path to the DaCapo <code>jar</code>.
The value is required.</p>
<p><code>minheap</code>: a string that selects one of the <code>minheap_values</code> sets to use.</p>
<p><code>minheap_values</code>: a dictionary containing multiple named sets of minimal heap sizes that is enough for a benchmark from the suite to run without triggering <code>OutOfMemoryError</code>.
Each size is measured in MiB.
The default value is an empty dictionary.
The minheap values are used only when running <code>runbms</code> with a valid <code>N</code> value.
If the minheap value for a benchmark is not specified, a default of <code>4096</code> is used.
An example looks like this.</p>
<pre><code class="language-yaml">minheap_values:
  adoptopenjdk-15-G1:
    avrora: 7
    batik: 253
  temurin-17-G1:
    avrora: 7
    batik: 189
</code></pre>
<p><code>timing_iteration</code>: specifying the timing iteration.
The value is passed to DaCapo as <code>-n</code>.
The default value is 3.</p>
<p><code>callback</code>: the class (possibly within some packages) for the DaCapo callback. The value is passed to DaCapo as <code>-c</code>.
The default value is <code>null</code>.</p>
<p><code>timeout</code>: timeout for one invocation of a benchmark in seconds.
The default value is <code>null</code>.</p>
<p><code>wrapper</code> (preview ⚠️): specifying a wrapper (i.e., extra stuff on the command line before <code>java</code>) when running benchmarks.
The default value is <code>null</code>, a no-op.
There are two possible ways to specify <code>wrapper</code>.
First, a single string with <a href="https://docs.python.org/3/library/shlex.html#shlex.split">shell-like syntax</a>.
Multiple arguments are space separated.
This wrapper is used for all benchmarks in the benchmark suite.
Second, a dictionary of strings with shell-like syntax to specify possibly different wrappers for different benchmarks.
If a benchmark doesn't have a wrapper in the dictionary, it is treated as <code>null</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="runtime"><a class="header" href="#runtime">Runtime</a></h1>
<h2 id="jikesrvm"><a class="header" href="#jikesrvm"><code>JikesRVM</code></a></h2>
<h2 id="nativeexecutable-preview-"><a class="header" href="#nativeexecutable-preview-"><code>NativeExecutable</code> (preview ⚠️)</a></h2>
<p>A <code>NativeExecutable</code> type specifies <a href="references/./commands/runbms.html"><code>runbms</code></a> to
directly run the benchmarks on native hardware. This is supposed to be used in
tandem with
<a href="references/./references/suite.html#BinaryBenchmarkSuite"><code>BinaryBenchmarkSuite</code></a>.</p>
<h2 id="openjdk"><a class="header" href="#openjdk"><code>OpenJDK</code></a></h2>
<div style="break-before: page; page-break-before: always;"></div><h1 id="modifier"><a class="header" href="#modifier">Modifier</a></h1>
<h2 id="envvar"><a class="header" href="#envvar"><code>EnvVar</code></a></h2>
<h3 id="keys-2"><a class="header" href="#keys-2">Keys</a></h3>
<p><code>var</code>: name of the variable.</p>
<p><code>val</code>: value of the variable.</p>
<h3 id="description"><a class="header" href="#description">Description</a></h3>
<p>Set an environment variable. Might override an environment variable inherited from the parent process.</p>
<h2 id="jvmarg"><a class="header" href="#jvmarg"><code>JVMArg</code></a></h2>
<p><code>JavaBenchmarkSuite</code> specific.</p>
<h3 id="keys-3"><a class="header" href="#keys-3">Keys</a></h3>
<p><code>val</code>: a single string with <a href="https://docs.python.org/3/library/shlex.html#shlex.split">shell-like syntax</a>.
Multiple arguments are space separated.</p>
<h3 id="description-1"><a class="header" href="#description-1">Description</a></h3>
<p>Specify arguments to a JVM, as opposed to the runtime.</p>
<h2 id="jvmclasspath"><a class="header" href="#jvmclasspath"><code>JVMClasspath</code></a></h2>
<p><code>JavaBenchmarkSuite</code> specific.</p>
<h3 id="keys-4"><a class="header" href="#keys-4">Keys</a></h3>
<p><code>val</code>: a single string with <a href="https://docs.python.org/3/library/shlex.html#shlex.split">shell-like syntax</a>.
Multiple classpaths are space separated.</p>
<h3 id="description-2"><a class="header" href="#description-2">Description</a></h3>
<p>Specify Java Classpaths.</p>
<h2 id="programarg"><a class="header" href="#programarg"><code>ProgramArg</code></a></h2>
<h3 id="keys-5"><a class="header" href="#keys-5">Keys</a></h3>
<p><code>val</code>: a single string with <a href="https://docs.python.org/3/library/shlex.html#shlex.split">shell-like syntax</a>.
Multiple arguments are space separated.</p>
<h3 id="description-3"><a class="header" href="#description-3">Description</a></h3>
<p>Specify arguments to a program, as opposed to the runtime.</p>
<h2 id="modifierset-preview-"><a class="header" href="#modifierset-preview-"><code>ModifierSet</code> (preview ⚠️)</a></h2>
<h3 id="keys-6"><a class="header" href="#keys-6">Keys</a></h3>
<p><code>val</code>: <code>|</code> separated values, with possible value options. See <a href="references/./index.html#value-options">here</a> for details.</p>
<h3 id="description-4"><a class="header" href="#description-4">Description</a></h3>
<p>Specify a set of modifiers, including other <code>ModifierSet</code>s.
That is, you can use <code>ModifierSet</code> recursively.</p>
<h2 id="wrapper-preview-"><a class="header" href="#wrapper-preview-"><code>Wrapper</code> (preview ⚠️)</a></h2>
<h3 id="keys-7"><a class="header" href="#keys-7">Keys</a></h3>
<p><code>val</code>: a single string with <a href="https://docs.python.org/3/library/shlex.html#shlex.split">shell-like syntax</a>.
Multiple arguments are space separated.</p>
<h3 id="description-5"><a class="header" href="#description-5">Description</a></h3>
<p>Specify a wrapper.
If a wrapper also exist for the benchmark suite you use, this wrapper will follow that.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="command-references"><a class="header" href="#command-references">Command References</a></h1>
<p>Please see the sections in this chapter for the references for each of the subcommands.</p>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<pre><code class="language-console">running [-h|--help] [-v|--verbose] [-d|--dry-run] [--version] subcommand
</code></pre>
<p><code>-h</code>: print help message.</p>
<p><code>-v</code>: use <code>DEBUG</code> for logging level.
The default logging level is <code>INFO</code>.</p>
<p><code>-d</code>: enable dry run.
Each of the subcommands that respect is flag will print out the commands to be executed in a child process instead of actually executing them.</p>
<p><code>--version</code>: print the version number of <code>running-ng</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="runbms"><a class="header" href="#runbms"><code>runbms</code></a></h1>
<p>This subcommand runs benchmarks with different configs, possibly with varying heap sizes.</p>
<h2 id="usage-1"><a class="header" href="#usage-1">Usage</a></h2>
<pre><code class="language-console">runbms [-h|--help] [-i|--invocations INVOCATIONS] [-s|--slice SLICE] [-p|--id-prefix ID_PREFIX] [-m|--minheap-multiplier MINHEAP_MULTIPLIER] [--skip-oom SKIP_OOM] [--skip-timeout SKIP_TIMEOUT] [--resume RESUME] LOG_DIR CONFIG [N] [n [n ...]]
</code></pre>
<p><code>-h</code>: print help message.</p>
<p><code>-i</code>: set the number of invocations.
Overrides <code>invocations</code> in the config file.</p>
<p><code>-s</code>: only use the specified heap sizes.
This is a comma-separated string of integers or floating point numbers.
For each slice <code>s</code> in <code>SLICE</code>, we run benchmarks at <code>s * minheap</code>.
<code>N</code> and <code>n</code>s are ignored. </p>
<p><code>-p</code>: add a prefix to the folder names where the results are stored.
By default, the folder that stores the result is named using the host name and the timestamp.
However, you can add a prefix to the folder name to signify which experiments the results belong to.</p>
<p><code>-m</code> (preview ⚠️): multiple the minheap value for each benchmark by <code>MINHEAP_MULTIPLIER</code>.
Do <strong>NOT</strong> use this unless you know what you are doing.
Override <code>minheap_multiplier</code> in the config file.</p>
<p><code>--skip-oom</code> (preview ⚠️): skip the remaining invocations if a benchmark under a <code>config</code> has run out of memory more than <code>SKIP_OOM</code> times.</p>
<p><code>--skip-timeout</code> (preview ⚠️): skip the remaining invocations if a benchmark under a <code>config</code>  has timed out more than <code>SKIP_TIMEOUT</code> times.</p>
<p><code>--resume</code> (preview ⚠️): resume a previous run under <code>LOG_DIR/RESUME</code>. If a <code>.log.gz</code> already exists for a group of invocations, they will be skipped. Remember to clean up the partial <code>*.log</code> files before resuming.</p>
<p><code>LOG_DIR</code>: where to store the results.
This is required.</p>
<p><code>CONFIG</code>: the path to the configuration file.
This is required.</p>
<p><code>N</code>: the number of different heap sizes to explore.
Must be powers of two.
Explore heap sizes denoted by 0, 1, ..., and <code>N</code> (<code>N + 1</code> different sizes in total).
The heap size 0 represents <code>1.0 * minheap</code>, and the heap size <code>N</code> represents <code>heap_range * minheap</code> (by default, <code>6.0 * minheap</code>).
If <code>N</code> is omitted, then the script will run benchmarks without explicit explicitly setting heap sizes, unless you specify <code>-s</code> or use a modifier that sets the heap size.</p>
<p><code>n</code>: the heap sizes to explore.
Instead of exploring 0, 1, ..., and <code>N</code>, only explore the <code>n</code>s specified.</p>
<h2 id="keys-8"><a class="header" href="#keys-8">Keys</a></h2>
<p><code>invocations</code>: see above.</p>
<p><code>minheap_multiplier</code>: see above.</p>
<p><code>heap_range</code>: the heap size relative to the minheap when <code>n = N</code>.</p>
<p><code>spread_factor</code>: changes how 0, 1, ..., and <code>N</code> are spread out.
When <code>spread_factor</code> is zero, the differences between 0, 1, ..., and <code>N</code> are the same.
The larger the <code>spread_factor</code> is, the coarser the spacing is at the end relative to start.
Please do <strong>NOT</strong> change this unless you understand how it works.</p>
<p><code>remote_host</code>: the remote host to <code>rsync</code> the results to.
The exact absolute path of <code>LOG_DIR</code> is used on both the local and the remote machine.</p>
<p><code>plugins</code> (preview ⚠️): plugins of this command.
Must be a dictionary, similar to how modifiers are declared.</p>
<h2 id="plugins-preview-"><a class="header" href="#plugins-preview-">Plugins (preview ⚠️)</a></h2>
<h3 id="zulip"><a class="header" href="#zulip"><code>Zulip</code></a></h3>
<p>Zulip integration for notifying when experiments start or end.
No message will be sent if it'a dry run.</p>
<p>Here is an example.</p>
<pre><code class="language-yaml">plugins:
  zulip:
    type: Zulip
    request:
      type: private
      to: [&quot;your user id here&quot;]
</code></pre>
<h4 id="keys-9"><a class="header" href="#keys-9">Keys</a></h4>
<p><code>request</code>: please follow the <a href="https://zulip.com/api/send-message">Zulip API documentation</a>.
Note that you don't need to put in <code>content</code> here.
Please contact the administrators of your organization for your user ID.</p>
<p><code>config_file</code>: an optional string to the path of config file.
If not specified, the default is <code>~/.zuliprc</code>.
Please make sure that this file can only be accessed by you (e.g., <code>chmod 600 ~/.zulip</code>).
If you are a moma user, please create this file on <code>squirrel</code>, and it will then be synced to other machines.
Please follow the Zulip documentation for the <a href="https://zulip.com/api/configuring-python-bindings">syntax</a> of the config file and for <a href="https://zulip.com/api/api-keys">obtaining an API key</a>.
If you can't create a new bot, please contact the administrators of your organization.</p>
<h2 id="interpreting-the-outputs"><a class="header" href="#interpreting-the-outputs">Interpreting the Outputs</a></h2>
<p>Under construction 🚧.</p>
<h3 id="console-outputs"><a class="header" href="#console-outputs">Console Outputs</a></h3>
<h3 id="log-directory"><a class="header" href="#log-directory">Log directory</a></h3>
<h2 id="heap-size-calculations"><a class="header" href="#heap-size-calculations">Heap Size Calculations</a></h2>
<p>Please refer to the source code like <a href="https://github.com/anupli/running-ng/blob/master/running/command/runbms.py#L47">here</a> and <a href="https://github.com/anupli/running-ng/blob/master/running/command/fillin.py#L5">here</a> for the actual algorithm.</p>
<p>But the basic idea is as follow.
First, we start with the ends and the middle and gradually fill the gap.
This is to make sure you can see the big picture trend.
Second, the difference between sizes are smaller for smaller sizes and larger for large sizes, because the performance is much more sensitive to the change in heap sizes when the heap is small.</p>
<h2 id="best-practices"><a class="header" href="#best-practices">Best Practices</a></h2>
<p>Under construction 🚧.</p>
<h3 id="continuously-monitor-your-experiments"><a class="header" href="#continuously-monitor-your-experiments">Continuously Monitor Your Experiments</a></h3>
<p>The results are <code>rsync</code>ed to <code>remote_host</code> once all invocations for a benchmark at a heap size are finished.
You shouldn't log into the experiment machine so not to disturb the experiments.
You should log into the remote host and check the <code>LOG_DIR</code> there and see the new results that came in.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="minheap"><a class="header" href="#minheap"><code>minheap</code></a></h1>
<p>This subcommand runs benchmarks with different <a href="commands/./references/index.html">configs</a>
while varying heap sizes in a binary search fashion in order to determine the
minimum heap required to run each benchmark.</p>
<p>The output is stored as a yaml file which can then be directly used as an
<a href="commands/./references/index.html#overrides">override</a> for minheap values for a benchmark
suite.</p>
<h2 id="usage-2"><a class="header" href="#usage-2">Usage</a></h2>
<pre><code class="language-console">minheap [-h|--help] CONFIG RESULT
</code></pre>
<p><code>-h</code>: print help message.</p>
<p><code>CONFIG</code>: the path to the configuration file.
This is required.</p>
<p><code>RESULT</code>: where to store the results.
This is required.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="fillin"><a class="header" href="#fillin"><code>fillin</code></a></h1>
<div style="break-before: page; page-break-before: always;"></div><p>Here are some recipes for common tasks.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="whole-process-performance-event-monitoring"><a class="header" href="#whole-process-performance-event-monitoring">Whole-Process Performance Event Monitoring</a></h1>
<h2 id="jvmti"><a class="header" href="#jvmti">JVMTI</a></h2>
<p>Please clone and build <a href="cookbook/../quickstart.html#prepare-probes"><code>probes</code></a>.</p>
<p>Under the <code>probes</code> folder, you will find a JVMTI agent, <code>libperf_statistics.so</code>.
You can check the source code <a href="https://github.com/anupli/probes/blob/master/native/jvmti_agents/perf_statistics.c">here</a>.
To use the agent, there are four things you need to do.</p>
<p>First, you will need to tell the dynamic linker to load the shared library before the VM boots.
This ensures that the <code>inherit</code> flag of <code>perf_event_attr</code> works properly and all child threads subsequently spawned are included in the results.</p>
<pre><code class="language-yaml">modifiers:
  jvmti_env:
    type: EnvVar
    var: &quot;LD_PRELOAD&quot;
    val: &quot;/path/to/probes/libperf_statistics.so&quot;
</code></pre>
<p>Second, you need to specify a list of events you want to measure.</p>
<pre><code class="language-yaml">modifiers:
  perf:
    type: EnvVar
    var: &quot;PERF_EVENTS&quot;
    val: &quot;PERF_COUNT_HW_CPU_CYCLES,PERF_COUNT_HW_INSTRUCTIONS,PERF_COUNT_HW_CACHE_LL:MISS,PERF_COUNT_HW_CACHE_L1D:MISS,PERF_COUNT_HW_CACHE_DTLB:MISS&quot;
</code></pre>
<p>If you want to get a full list of events you can use on a particular machine, you can clone and build <a href="https://sourceforge.net/p/perfmon2/libpfm4/ci/master/tree/"><code>libpfm4</code></a> and run the <code>showevtinfo</code> <a href="https://sourceforge.net/p/perfmon2/libpfm4/ci/master/tree/examples/showevtinfo.c">program</a>.</p>
<p>Third, you need to tell the JVM to load the agent.
Note that you need to specify the absolute path.</p>
<pre><code class="language-yaml">modifiers:
  jvmti:
    type: JVMArg
    val: &quot;-agentpath:/path/to/probes/libperf_statistics.so&quot;
</code></pre>
<p>Finally, you need to let the DaCapo benchmark inform the start and the end of a benchmark iteration.
We will reuse the <code>RustMMTk</code> probe here, as the callback functions in the JVMTI agent are also called <code>harness_begin</code> and <code>harness_end</code>.</p>
<pre><code class="language-yaml">modifiers:
  probes_cp:
    type: JVMClasspath
    val: &quot;/path/to/probes /path/to/probes/probes.jar&quot;
  probes:
    type: JVMArg
    val: &quot;-Djava.library.path=/path/to/probes -Dprobes=RustMMTk&quot;
</code></pre>
<p>Now, putting it all together, you can define a set of modifiers, and use that set in your config strings.</p>
<pre><code class="language-yaml">modifiers:
  jvmti_common:
    type: ModifierSet
    val: &quot;probes|probes_cp|jvmti|jvmti_env|perf&quot;
</code></pre>
<h2 id="mmtk"><a class="header" href="#mmtk">MMTk</a></h2>
<p>Please clone and build <a href="cookbook/../quickstart.html#prepare-probes"><code>probes</code></a>.
You will need to build <code>mmtk-core</code> with the <code>perf_counter</code> feature.</p>
<p>First, you need to let the DaCapo benchmark inform the start and the end of a benchmark iteration.</p>
<pre><code class="language-yaml">modifiers:
  probes_cp:
    type: JVMClasspath
    val: &quot;/path/to/probes /path/to/probes/probes.jar&quot;
  probes:
    type: JVMArg
    val: &quot;-Djava.library.path=/path/to/probes -Dprobes=RustMMTk&quot;
</code></pre>
<p>Then, you can specify a list of events you want to measure.</p>
<pre><code class="language-yaml">modifiers:
  mmtk_perf:
    type: EnvVar
    var: &quot;MMTK_PHASE_PERF_EVENTS&quot;
    val: &quot;PERF_COUNT_HW_CPU_CYCLES,0,-1;PERF_COUNT_HW_INSTRUCTIONS,0,-1;PERF_COUNT_HW_CACHE_LL:MISS,0,-1;PERF_COUNT_HW_CACHE_L1D:MISS,0,-1;PERF_COUNT_HW_CACHE_DTLB:MISS,0,-1&quot;
</code></pre>
<p>Note that the list is semicolon-separated.
Each entry consists of three parts, separated by commas.
The first part is the name of the event.
Please refer to the previous section for details.
The second part and the third part are <code>pid</code> and <code>cpu</code>, per <code>man perf_event_open</code>.
In most cases, you want to use <code>0,-1</code>, that is measuring the calling thread (the results will be combined later through the <code>inherit</code> flag) on any CPU.
For some events, such as RAPL, only package-wide measurement is supported, and you will have to adjust the values accordingly.</p>
<p><strong>Note that you might have to increase the value of <code>MAX_PHASES</code> in <code>crate::util::statistics::stats</code> to a larger value, e.g., <code>1 &lt;&lt; 14</code>, so that the array storing the per-phase value will not overflow.</strong></p>
<h1 id="work-packet-performance-event-monitoring"><a class="header" href="#work-packet-performance-event-monitoring">Work-Packet Performance Event Monitoring</a></h1>
<p>It's similar to the whole-process performance event monitoring for MMTk.
Just use <code>MMTK_WORK_PERF_EVENTS</code> instead of <code>MMTK_PHASE_PERF_EVENTS</code>.</p>
<h1 id="machine-specific-notes"><a class="header" href="#machine-specific-notes">Machine-Specific Notes</a></h1>
<p>On Xeon D-1540 Broadwell (<code>mole</code> and <code>vole</code>), the <code>PERF_COUNT_HW_CACHE_LL:MISS</code> event is always zero.</p>
<pre><code class="language-console">perf stat -e LLC-load-misses,cycles /bin/ls

 Performance counter stats for '/bin/ls':

                 0      LLC-load-misses
         1,729,786      cycles

       0.001135511 seconds time elapsed

       0.001180000 seconds user
       0.000000000 seconds sys
</code></pre>
<p>On AMD machines, the <code>PERF_COUNT_HW_CACHE_LL:MISS</code> event fails to open.
<code>perf_event_open</code> syscall fails with <code>No such file or directory</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="frequently-asked-questions"><a class="header" href="#frequently-asked-questions">Frequently Asked Questions</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="changelog"><a class="header" href="#changelog">Changelog</a></h1>
<h2 id="master"><a class="header" href="#master"><code>master</code></a></h2>
<h3 id="features"><a class="header" href="#features">Features</a></h3>
<h3 id="improvements"><a class="header" href="#improvements">Improvements</a></h3>
<h2 id="a-hrefhttpsgithubcomanuplirunning-ngreleasestag010010-2021-08-09a"><a class="header" href="#a-hrefhttpsgithubcomanuplirunning-ngreleasestag010010-2021-08-09a"><a href="https://github.com/anupli/running-ng/releases/tag/0.1.0"><code>0.1.0</code> (2021-08-09)</a></a></h2>
<p>Initial release.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
    </body>
</html>
